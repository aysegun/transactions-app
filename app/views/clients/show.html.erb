<h4 style="margin-top:25px; margin-left:25px;">Calculation for <%= @client.last_name %>, <%= @client.first_name %></h4>
<div class="show-page-container">
  <div class="left-card">
    <div class="card-balance d-flex" style= "gap: 250px">
      <p style="font-weight: bold">Balance <i class="fa-solid fa-coins"></i></p>
      <p><%= Date.today %> <i class="fa-regular fa-calendar-days"></i></p>
    </div>
    <div class="d-flex" style= "gap: 250px">
      <h4 class="<%=(@payments.sum(:amount) - @expenses.sum(:amount)).negative? ? 'neg-balance' : 'pos-balance' %>"><%= (@payments.sum(:amount) - @expenses.sum(:amount)) %> <i class="fa-solid fa-turkish-lira-sign"></i></h4>
      <%= link_to "Create Transaction", new_client_transaction_path(@client), class:"button-b" %>
    </div>
    <div class="calculation-container mt-5">
      <table>
        <thead>
          <tr>
            <th>Total Expenses <i class="fa-regular fa-paper-plane"></i></th>
            <th>Total Payments <i class="fa-solid fa-arrow-down"></i></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%= @expenses.sum(:amount) %> <i class="fa-solid fa-turkish-lira-sign"></td>
            <td><%= @payments.sum(:amount) %> <i class="fa-solid fa-turkish-lira-sign"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div>
      <%= link_to "Return Clients", clients_path, class:"btn btn-primary mt-5" %>
      <%= button_to "Delete Client", @client, method: :delete, data: {turbo_confirm: "Are you sure you want to delete this client?"}, class:"btn btn-danger mt-3" %>
      <%= link_to "Edit Client", edit_client_path,  class: "btn btn-warning mt-3" %>
    </div>
  </div>
  <div class="right-card">
    <h4>Transaction History for <%= @client.last_name %>, <%= @client.first_name %></h4>
    <div class="table-card">
      <p>Expenses</p>
      <div class="expense-table mt-3">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Amount <i class="fa-solid fa-turkish-lira-sign"></th>
              <th>Type</th>
              <th>Description</th>
              <th>Court</th>
              <th>Court Number</th>
              <th>Actions</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% @transactions.each do |transaction| %>
              <% if transaction.transaction_type == 'expense' %>
                <tr>
                  <td><%= transaction.date.strftime('%b %d, %Y') %></td>
                  <td><%= transaction.amount %></td>
                  <td style="color:#bb2d3b"><%= transaction.transaction_type %></td>
                  <td><%= transaction.description %></td>
                  <% transaction.transaction_cases.each do |transaction_case| %>
                    <% case_record = transaction_case.case %>
                    <td><%= case_record&.court %></td>
                    <td><%= case_record&.court_number %></td>
                  <% end %>

                  <td><%= button_to "", client_transaction_path(@client, transaction), class: "fa-regular fa-trash-can",
                                    method: :delete, data: { turbo_confirm: "Are you sure you want to delete this transaction?" } %></td>
                  <td><%= link_to "Edit", edit_client_transaction_path(@client, transaction) %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="mt-5">
        <p style="font-weight: bold">Payments</p>
        <div class="payment-table mt-3">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Amount <i class="fa-solid fa-turkish-lira-sign"></th>
                <th>Type</th>
                <th>Description</th>
                <th>Actions</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @transactions.each do |transaction| %>
                <% if transaction.transaction_type == 'payment' %>
                  <tr>
                    <td><%= transaction.date.strftime('%b %d, %Y') %></td>
                    <td><%= transaction.amount %></td>
                    <td style="color:#198754"><%= transaction.transaction_type %></td>
                    <td><%= transaction.description %></td>

                    <td style="padding: 0"><%= button_to "", client_transaction_path(@client, transaction), class: "fa-regular fa-trash-can",
                                      method: :delete, data: { turbo_confirm: "Are you sure you want to delete this transaction?" } %></td>
                    <td><%= link_to "", edit_client_transaction_path(@client, transaction), class:"fa-regular fa-pen-to-square"%></td>
                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
