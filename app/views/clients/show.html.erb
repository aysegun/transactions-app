<h3>Show page</h3>
<p>Find me on "...clients/views/clients/show.html.erb"</p>

<h3>Transaction History for <%= @client.last_name %>, <%= @client.first_name %></h3>

<div>
  <div>
    <table>
      <thead>
        <tr>
          <th>Amount</th>
          <th>Description</th>
          <th>Date</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        <% @transactions.each do |transaction| %>
            <tr>
              <td><%= transaction.amount %></td>
              <td><%= transaction.description %></td>
              <td><%= transaction.date %></td>
              <td><%= transaction.transaction_type %></td>
                <% if transaction.transaction_type == 'expense' %>
                    <% transaction_cases = TransactionCase.where(transaction_id: transaction.id) %>
                    <% if transaction_cases.any? %>
                      <% transaction_cases.each do |transaction_case| %>
                        <% case_record = transaction_case.case %>
                        <td>Court: <%= transaction_cases.first&.case&.court %></td></td>
                        <td>Court Number: <%= transaction_cases.first&.case&.court_number %></td>
                      <% end %>
                    <% end %>
                <% end %>
              <td><%= button_to "Delete Transaction", client_transaction_path(@client, transaction), method: :delete, data: {turbo_confirm: "Are you sure you want to delete this transaction?"} %></td>
              <td> <%= link_to "Edit Transaction", edit_client_transaction_path(@client, transaction) %></td>
            </tr>
          <% end %>
      </tbody>
    </table>
  </div>
  <h3>Calculation for <%= @client.last_name %>, <%= @client.first_name %></h3>
  <div>
    <table>
      <thead>
        <tr>
        <th>Total Expenses</th>
        <th>Total Payments</th>
        <th>Client's Balance</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= @expenses.sum(:amount) %></td>
          <td><%= @payments.sum(:amount) %></td>
          <td><%= (@payments.sum(:amount) - @expenses.sum(:amount)) %></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<%= link_to "Return clients", clients_path %>
<%= link_to "Create transaction", new_client_transaction_path(@client) %>
<p></p>
<%= button_to "Delete Client", @client, method: :delete, data: {turbo_confirm: "Are you sure you want to delete this client?"} %>
<p></p>
<%= link_to "Edit Client", edit_client_path %>
