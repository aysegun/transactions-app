<h3>Show page</h3>
<p>Find me on "...clients/views/clients/show.html.erb"</p>

<h3>Calculation for <%= @client.last_name %>, <%= @client.first_name %></h3>
<h3><%= Date.today %></h3>
  <div class="calculation-container">
  <h4>Balance</h4>
  <h3><%= (@payments.sum(:amount) - @expenses.sum(:amount)) %> TL</h3>
    <table>
      <thead>
        <tr>
          <th>Total Expenses</th>
          <th>Total Payments</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= @expenses.sum(:amount) %></td>
          <td><%= @payments.sum(:amount) %></td>
        </tr>
      </tbody>
    </table>
  </div>

<h3>Expense History for <%= @client.last_name %>, <%= @client.first_name %></h3>

<div>
  <div class="expense-table">
    <table>
      <thead>
        <tr>
          <th>Amount</th>
          <th>Description</th>
          <th>Date</th>
          <th>Type</th>
          <th>Court</th>
          <th>Court Number</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% @transactions.each do |transaction| %>
          <% if transaction.transaction_type == 'expense' %>
            <tr>
              <td><%= transaction.amount %></td>
              <td><%= transaction.description %></td>
              <td><%= transaction.date %></td>
              <td><%= transaction.transaction_type %></td>

              <% transaction.transaction_cases.each do |transaction_case| %>
                <% case_record = transaction_case.case %>
                <td><%= case_record&.court %></td>
                <td><%= case_record&.court_number %></td>
              <% end %>

              <td><%= button_to "Delete Transaction", client_transaction_path(@client, transaction),
                                method: :delete, data: { turbo_confirm: "Are you sure you want to delete this transaction?" } %></td>
              <td><%= link_to "Edit Transaction", edit_client_transaction_path(@client, transaction) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div>
    <h3>Payment History for <%= @client.last_name %>, <%= @client.first_name %></h3>
    <div class="payment-table">
      <table>
        <thead>
          <tr>
            <th>Amount</th>
            <th>Description</th>
            <th>Date</th>
            <th>Type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% @transactions.each do |transaction| %>
            <% if transaction.transaction_type == 'payment' %>
              <tr>
                <td><%= transaction.amount %></td>
                <td><%= transaction.description %></td>
                <td><%= transaction.date %></td>
                <td><%= transaction.transaction_type %></td>
                <td><%= button_to "Delete Transaction", client_transaction_path(@client, transaction),
                                  method: :delete, data: { turbo_confirm: "Are you sure you want to delete this transaction?" } %></td>
                <td><%= link_to "Edit Transaction", edit_client_transaction_path(@client, transaction) %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%= link_to "Return clients", clients_path %>
<%= link_to "Create transaction", new_client_transaction_path(@client) %>
<p></p>
<%= button_to "Delete Client", @client, method: :delete, data: {turbo_confirm: "Are you sure you want to delete this client?"} %>
<p></p>
<%= link_to "Edit Client", edit_client_path %>
